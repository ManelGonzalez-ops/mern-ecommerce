import React, { useState, useEffect, Fragment } from 'react'
import { Link } from "react-router-dom"
import { useSelector, useDispatch } from "react-redux"
import Cookie from "js-cookie"
import { userLogout } from "../actions/userActions"

export default function Nav() {

    const [openDropdown, setOpenDropdown] = useState(false)
    const [movileMenu, setMovileMenu] = useState(false)
    const [qty, setQty] = useState(0)

    const { userInfo } = useSelector(state => state.userSignin)


    const dispatch = useDispatch()
    const logout = () => {
        dispatch(userLogout())
    }

    const { cartItems } = useSelector(state => state.cart)

    useEffect(() => {
        const total = cartItems.reduce((x, y) => x + parseInt(y.qty), 0)
        setQty(total)
    }, [cartItems])

    return (
        <header>
            <a className="logo">Amazon shop</a>
            <span onClick={() => { setMovileMenu(true) }}>
                <svg viewBox="0 0 18 15" height="40px" width="40px" className={movileMenu ? "burger close" : "burger"}>
                    <path fill="#fff" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z" />
                    <path fill="#fff" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z" />
                    <path fill="#fff" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z" />
                </svg>
            </span>

            <nav>
                <ul className="nav-list">
                    <li className="nav-item"><Link className="text-center" to="/">Shop</Link></li>
                    <li className="nav-item"><Link className="text-center" to="/cart">Cart</Link></li>
                    {userInfo ?

                        <li className="nav-item dropdown"
                            onMouseOver={() => { setOpenDropdown(true) }}
                            onMouseOut={() => { setOpenDropdown(false) }}>
                            <span className="text-center">
                                Account
                            </span>
                            <ul className={openDropdown ? "dropdown-list open" : "dropdown-list "}>
                                <li className="dropdown-list-item"><Link to="/user">Profile</Link></li>
                                <li className="dropdown-list-item"
                                    onClick={logout}>Log out</li>
                                <li className="dropdown-list-item"><Link to="/addstore">Admin section</Link></li>
                            </ul>
                        </li>

                        :

                        <li className="nav-item"><Link to="/signin" className="text-center">Signin</Link></li>}

                    <li className="nav-item with-cart"><div>{qty}</div><SvgCart /></li>
                </ul>

            </nav>


            <ul className={movileMenu ? "movile-dropdown open" : "movile-dropdown"}>
                {userInfo ?
                    <Fragment>
                        <li className="arrow"
                            onClick={() => { setMovileMenu(false) }}
                        ><strong>&#8594;</strong></li>
                        <li className="movile"><Link to="/user">Profile</Link><SvgProfile /></li>
                        <li className="movile"
                            onClick={logout}><span>Log out</span><SvgLogout /></li>

                        <li className="movile"><Link to="/addstore">Admin section</Link><SvgAdmin /></li>
                    </Fragment>
                    :
                    <Fragment>
                        <li className="arrow"
                            onClick={() => { setMovileMenu(false) }}
                        ><strong>&#8594;</strong></li>
                        <li className="movile"><Link to="/signin">Signin</Link><SvgLogin /></li>
                        <li className="movile"><Link to="/addstore">Admin section</Link><SvgAdmin /></li>
                    </Fragment>
                }


            </ul>

        </header>
    )
}




export const CloseBtn = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18"><path d="M14.53 4.53l-1.06-1.06L9 7.94 4.53 3.47 3.47 4.53 7.94 9l-4.47 4.47 1.06 1.06L9 10.06l4.47 4.47 1.06-1.06L10.06 9z" /></svg>


const SvgLogin = () =>
    <svg width="28" height="28" viewBox="0 0 10 14" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M9 0H1C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V4.5H4.25L2.56 2.855C2.47809 2.75935 2.43528 2.63631 2.44014 2.51047C2.44501 2.38464 2.49717 2.26527 2.58622 2.17622C2.67527 2.08717 2.79464 2.035 2.92047 2.03014C3.04631 2.02528 3.16935 2.06809 3.265 2.15L6.16 5.045L3.265 7.94C3.16935 8.02191 3.04631 8.06472 2.92047 8.05986C2.79464 8.05499 2.67527 8.00283 2.58622 7.91378C2.49717 7.82473 2.44501 7.70536 2.44014 7.57953C2.43528 7.45369 2.47809 7.33065 2.56 7.235L4.25 5.5H0V13C0 13.2652 0.105357 13.5196 0.292893 13.7071C0.48043 13.8946 0.734784 14 1 14H9C9.26522 14 9.51957 13.8946 9.70711 13.7071C9.89464 13.5196 10 13.2652 10 13V1C10 0.734784 9.89464 0.48043 9.70711 0.292893C9.51957 0.105357 9.26522 0 9 0V0Z" fill="black" />
    </svg>



const SvgLogout = () =>
    <svg width="28" height="28" viewBox="0 0 15 14" fill="none" xmlns="http://www.w3.org/2000/svg" style={{ position: "relative", left: "5px" }}>
        <path d="M9 0H1C0.734784 0 0.48043 0.105357 0.292893 0.292893C0.105357 0.48043 0 0.734784 0 1V13C0 13.2652 0.105357 13.5196 0.292893 13.7071C0.48043 13.8946 0.734784 14 1 14H9C9.26522 14 9.51957 13.8946 9.70711 13.7071C9.89464 13.5196 10 13.2652 10 13V10H5.315C5.18239 10 5.05521 9.94732 4.96145 9.85355C4.86768 9.75979 4.815 9.63261 4.815 9.5C4.815 9.36739 4.86768 9.24021 4.96145 9.14645C5.05521 9.05268 5.18239 9 5.315 9H10V1C10 0.734784 9.89464 0.48043 9.70711 0.292893C9.51957 0.105357 9.26522 0 9 0V0Z" fill="black" />
        <path d="M11.58 6.64C11.4843 6.55809 11.3613 6.51529 11.2355 6.52015C11.1096 6.52501 10.9903 6.57718 10.9012 6.66622C10.8122 6.75527 10.76 6.87464 10.7551 7.00048C10.7503 7.12631 10.7931 7.24935 10.875 7.345L12.565 9H10V10H12.565L10.875 11.73C10.8227 11.7748 10.7801 11.83 10.7501 11.892C10.7201 11.9541 10.7033 12.0216 10.7006 12.0905C10.6979 12.1593 10.7095 12.228 10.7347 12.2922C10.7598 12.3563 10.7979 12.4146 10.8467 12.4633C10.8954 12.5121 10.9537 12.5502 11.0178 12.5753C11.082 12.6005 11.1507 12.6121 11.2195 12.6094C11.2884 12.6067 11.356 12.5899 11.418 12.5599C11.48 12.5299 11.5352 12.4873 11.58 12.435L14.5 9.535L11.58 6.64Z" fill="black" />
    </svg>



const SvgAdmin = () =>
    <svg width="28" height="28" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M17 10H14.82C14.65 10.7 14.38 11.35 14.01 11.93L15.55 13.47L13.45 15.57L11.91 14.03C11.33 14.39 10.68 14.66 10 14.82V17H7V14.82C6.32 14.66 5.67 14.39 5.09 14.03L3.55 15.57L1.43 13.45L2.97 11.91C2.61 11.33 2.34 10.68 2.18 10H0V7.03H2.17C2.33 6.33 2.61 5.68 2.97 5.09L1.43 3.55L3.53 1.45L5.07 2.99C5.65 2.62 6.31 2.35 7 2.18V0H10V2.18C10.68 2.34 11.33 2.61 11.91 2.97L13.45 1.43L15.57 3.55L14.03 5.09C14.39 5.68 14.67 6.33 14.83 7.03H17V10ZM8.5 11.5C10.16 11.5 11.5 10.16 11.5 8.5C11.5 6.84 10.16 5.5 8.5 5.5C6.84 5.5 5.5 6.84 5.5 8.5C5.5 10.16 6.84 11.5 8.5 11.5Z" fill="black" />
    </svg>



const SvgProfile = () =>
    <svg width="28" height="28" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M7 0C5.61553 0 4.26216 0.410543 3.11101 1.17971C1.95987 1.94888 1.06266 3.04213 0.532846 4.32122C0.00303298 5.6003 -0.13559 7.00777 0.134506 8.36563C0.404603 9.7235 1.07129 10.9708 2.05026 11.9497C3.02922 12.9287 4.2765 13.5954 5.63437 13.8655C6.99224 14.1356 8.3997 13.997 9.67879 13.4672C10.9579 12.9373 12.0511 12.0401 12.8203 10.889C13.5895 9.73785 14 8.38447 14 7C14 5.14348 13.2625 3.36301 11.9497 2.05025C10.637 0.737498 8.85652 0 7 0V0ZM11 11.4595V11.1555C11.0139 10.4737 10.7598 9.81365 10.2924 9.31712C9.82494 8.8206 9.1814 8.52722 8.5 8.5H5.5C4.81918 8.52735 4.1763 8.82087 3.7097 9.3174C3.24309 9.81394 2.99004 10.4738 3.005 11.155C3.005 11.1605 3 11.166 3 11.1715V11.464C2.09296 10.6543 1.45317 9.58831 1.16534 8.40703C0.877499 7.22574 0.955181 5.9849 1.3881 4.84874C1.82102 3.71257 2.58876 2.73467 3.58971 2.04446C4.59066 1.35424 5.77761 0.984273 6.99345 0.983513C8.2093 0.982753 9.39671 1.35124 10.3985 2.0402C11.4003 2.72916 12.1693 3.70611 12.6036 4.84173C13.038 5.97735 13.1172 7.21809 12.8308 8.39974C12.5445 9.58138 11.906 10.6482 11 11.459V11.4595Z" fill="black" />
        <path d="M7 2.5C6.50555 2.5 6.0222 2.64662 5.61108 2.92133C5.19995 3.19603 4.87952 3.58648 4.6903 4.04329C4.50108 4.50011 4.45157 5.00277 4.54804 5.48773C4.6445 5.97268 4.8826 6.41814 5.23223 6.76777C5.58187 7.1174 6.02732 7.3555 6.51228 7.45196C6.99723 7.54843 7.4999 7.49892 7.95671 7.3097C8.41353 7.12048 8.80397 6.80005 9.07868 6.38893C9.35338 5.9778 9.5 5.49445 9.5 5C9.5 4.33696 9.23661 3.70107 8.76777 3.23223C8.29893 2.76339 7.66304 2.5 7 2.5V2.5Z" fill="black" />
    </svg>



const SvgCart = () =>
    <svg width="50" height="50" viewBox="0 0 37 37" fill="none" xmlns="http://www.w3.org/2000/svg" style={{ cursor: "pointer" }}>

        <path d="M30.6096 6H29.4375V6.37333C27.8058 6.73833 27.5712 8.25292 27.4791 8.83167C27.4354 9.10542 27.3466 9.64083 27.2366 10.2967H6.82818C6.02068 10.2967 5.93026 11.0512 6.03568 11.4687L8.42986 22.0383C8.53486 22.4558 8.97695 22.7967 9.41028 22.7967H27.3037C27.7346 22.7967 28.0858 23.1471 28.0858 23.5779C28.0858 24.0087 27.7346 24.3592 27.3037 24.3592H7.77277C7.56557 24.3592 7.36685 24.4415 7.22034 24.588C7.07383 24.7345 6.99152 24.9332 6.99152 25.1404C6.99152 25.3476 7.07383 25.5463 7.22034 25.6928C7.36685 25.8394 7.56557 25.9217 7.77277 25.9217H8.78528C8.2964 26.1916 7.88885 26.5876 7.60509 27.0686C7.32133 27.5496 7.17175 28.0978 7.17193 28.6562H7.95319C7.95319 29.95 9.0032 31 10.297 31C11.5907 31 12.6407 29.95 12.6407 28.6562H13.422C13.4221 28.0978 13.2724 27.5495 12.9886 27.0686C12.7047 26.5876 12.2971 26.1915 11.8082 25.9217H22.8474C22.3585 26.1915 21.9509 26.5876 21.6671 27.0686C21.3833 27.5495 21.2336 28.0978 21.2337 28.6562H22.0149C22.0265 29.2703 22.2786 29.8553 22.7169 30.2855C23.1553 30.7156 23.745 30.9566 24.3591 30.9566C24.9733 30.9566 25.5629 30.7156 26.0013 30.2855C26.4397 29.8553 26.6917 29.2703 26.7033 28.6562H27.4846C27.4846 28.0978 27.335 27.5496 27.0512 27.0687C26.7675 26.5878 26.36 26.1917 25.8712 25.9217H27.3046C27.9261 25.9213 28.522 25.6743 28.9615 25.2348C29.401 24.7954 29.648 24.1994 29.6483 23.5779C29.6483 23.2701 29.5876 22.9653 29.4697 22.6809C29.3519 22.3965 29.1792 22.1381 28.9614 21.9205C28.7437 21.7028 28.4853 21.5302 28.2008 21.4124C27.9164 21.2947 27.6116 21.2341 27.3037 21.2342H27.0133L28.0125 15.0217C28.2908 13.3808 28.8908 9.83625 29.0317 8.95458C29.1025 8.50917 29.1712 8.19625 29.4375 8.02083V8.34333H30.6096C30.713 8.343 30.812 8.30182 30.8851 8.22877C30.9583 8.15571 30.9996 8.0567 31 7.95333V6.39083C30.9998 6.28732 30.9586 6.1881 30.8854 6.11486C30.8123 6.04163 30.7131 6.00033 30.6096 6V6ZM10.297 29.8283C9.9862 29.828 9.68826 29.7044 9.46853 29.4847C9.24879 29.2649 9.12519 28.967 9.12486 28.6562H11.4686C11.4683 28.9669 11.3448 29.2648 11.1251 29.4845C10.9055 29.7042 10.6076 29.8279 10.297 29.8283V29.8283ZM24.3595 29.8283C24.0487 29.8281 23.7507 29.7046 23.5308 29.4848C23.311 29.2651 23.1874 28.9671 23.187 28.6562H25.5316C25.5311 28.9669 25.4074 29.2647 25.1877 29.4844C24.968 29.7041 24.6702 29.8278 24.3595 29.8283V29.8283ZM23.3983 12.2475C23.412 12.1416 23.4633 12.0442 23.5429 11.9729C23.6224 11.9016 23.7249 11.8613 23.8316 11.8592H26.3054C26.5204 11.8592 26.67 12.0325 26.6362 12.2454L26.3912 13.8167C26.3587 14.0292 26.155 14.2029 25.9396 14.2029H23.58C23.5303 14.2042 23.4809 14.1948 23.4352 14.1752C23.3895 14.1556 23.3486 14.1263 23.3153 14.0894C23.282 14.0525 23.2571 14.0089 23.2423 13.9614C23.2275 13.914 23.2231 13.8639 23.2295 13.8146L23.3983 12.2475V12.2475ZM22.9779 16.1537C22.9919 16.048 23.0432 15.9507 23.1227 15.8794C23.2022 15.8082 23.3045 15.7678 23.4112 15.7654H25.6958C25.9112 15.7654 26.0604 15.9387 26.0279 16.1517L25.8433 17.3325C25.8104 17.545 25.607 17.7187 25.3916 17.7187H23.2012C23.1516 17.7199 23.1022 17.7104 23.0566 17.6907C23.011 17.6711 22.9702 17.6418 22.9369 17.605C22.9036 17.5681 22.8787 17.5245 22.8639 17.4771C22.849 17.4297 22.8445 17.3797 22.8508 17.3304L22.9779 16.1537V16.1537ZM8.02736 13.8237L7.63152 12.2383C7.57985 12.0292 7.71402 11.8592 7.92944 11.8592H10.8707C11.0865 11.8592 11.2811 12.0337 11.304 12.2475L11.4724 13.815C11.4786 13.8642 11.4742 13.9142 11.4593 13.9616C11.4445 14.0089 11.4196 14.0525 11.3864 14.0894C11.3532 14.1263 11.3124 14.1555 11.2668 14.1752C11.2213 14.1948 11.172 14.2044 11.1224 14.2033H8.51361C8.29861 14.2033 8.07944 14.0321 8.02736 13.8237V13.8237ZM9.39028 17.7187C9.17528 17.7187 8.95611 17.5479 8.90444 17.3396L8.60611 16.145C8.55403 15.9358 8.68736 15.7658 8.90278 15.7658H11.2899C11.5053 15.7658 11.7003 15.9404 11.7232 16.1542L11.8499 17.3308C11.8562 17.3801 11.8518 17.4301 11.837 17.4775C11.8222 17.5249 11.7973 17.5685 11.7641 17.6054C11.7308 17.6423 11.69 17.6715 11.6444 17.6912C11.5988 17.7108 11.5495 17.7204 11.4999 17.7192H9.39028V17.7187ZM11.8774 21.2346H10.267C10.0507 21.2346 9.83278 21.0637 9.7807 20.8554L9.48236 19.6608C9.4307 19.4517 9.56403 19.2817 9.77987 19.2817H11.6674C11.8828 19.2817 12.0778 19.4562 12.1015 19.67L12.2274 20.8467C12.2337 20.8959 12.2293 20.9459 12.2145 20.9933C12.1997 21.0406 12.1748 21.0842 12.1416 21.1211C12.1083 21.1579 12.0675 21.1871 12.0219 21.2067C11.9763 21.2263 11.927 21.2358 11.8774 21.2346V21.2346ZM16.6657 20.8437C16.6653 20.9474 16.6239 21.0467 16.5505 21.1199C16.4771 21.1931 16.3777 21.2344 16.2741 21.2346H14.2361C14.1295 21.2324 14.0271 21.192 13.9476 21.1207C13.8682 21.0495 13.817 20.9521 13.8032 20.8462L13.6766 19.6696C13.6701 19.6204 13.6744 19.5703 13.6891 19.5229C13.7039 19.4755 13.7287 19.4318 13.7619 19.3949C13.7951 19.358 13.836 19.3287 13.8816 19.3091C13.9272 19.2895 13.9765 19.28 14.0261 19.2812H16.2741C16.3778 19.2812 16.4773 19.3224 16.5507 19.3957C16.6242 19.4689 16.6655 19.5684 16.6657 19.6721V20.8437V20.8437ZM16.6657 17.3283C16.6653 17.432 16.6239 17.5313 16.5505 17.6045C16.4771 17.6777 16.3777 17.7189 16.2741 17.7192H13.8582C13.6432 17.7192 13.4491 17.5446 13.4249 17.3308L13.2991 16.1542C13.2927 16.1049 13.297 16.0549 13.3118 16.0075C13.3265 15.9602 13.3514 15.9165 13.3846 15.8796C13.4178 15.8427 13.4586 15.8135 13.5042 15.7938C13.5497 15.7742 13.599 15.7646 13.6486 15.7658H16.2741C16.3778 15.7658 16.4773 15.807 16.5507 15.8803C16.6242 15.9535 16.6655 16.0529 16.6657 16.1567V17.3283V17.3283ZM16.6657 13.8125C16.6653 13.9162 16.6239 14.0154 16.5505 14.0887C16.4771 14.1619 16.3777 14.2031 16.2741 14.2033H13.4816C13.3748 14.2012 13.2723 14.1609 13.1928 14.0896C13.1133 14.0183 13.062 13.9209 13.0482 13.815L12.8799 12.2475C12.8736 12.1983 12.878 12.1482 12.8928 12.1008C12.9076 12.0535 12.9325 12.0098 12.9657 11.973C12.9989 11.9361 13.0398 11.9068 13.0854 11.8872C13.131 11.8675 13.1803 11.858 13.2299 11.8592H16.2745C16.3782 11.8592 16.4777 11.9003 16.5511 11.9736C16.6246 12.0469 16.6659 12.1463 16.6662 12.25V13.8125H16.6657ZM20.8987 20.8462C20.8849 20.9521 20.8335 21.0495 20.754 21.1208C20.6745 21.192 20.5721 21.2324 20.4653 21.2346H18.6237C18.52 21.2344 18.4207 21.1931 18.3474 21.1199C18.2741 21.0467 18.2328 20.9474 18.2324 20.8437V19.6717C18.2326 19.568 18.2739 19.4687 18.3473 19.3954C18.4206 19.3221 18.52 19.2809 18.6237 19.2808H20.6754C20.8904 19.2808 21.0487 19.4554 21.0254 19.6692L20.8987 20.8462ZM21.2762 17.3304C21.2624 17.4363 21.211 17.5337 21.1315 17.6049C21.052 17.6762 20.9496 17.7166 20.8429 17.7187H18.6237C18.52 17.7185 18.4207 17.6773 18.3474 17.6041C18.2741 17.5308 18.2328 17.4315 18.2324 17.3279V16.1558C18.2326 16.0522 18.2739 15.9528 18.3473 15.8796C18.4206 15.8063 18.52 15.7651 18.6237 15.765H21.0529C21.2683 15.765 21.4262 15.9396 21.4024 16.1533L21.2762 17.3304ZM21.6537 13.815C21.6399 13.9209 21.5885 14.0183 21.509 14.0895C21.4295 14.1608 21.3271 14.2011 21.2204 14.2033H18.6237C18.52 14.2031 18.4207 14.1619 18.3474 14.0886C18.2741 14.0154 18.2328 13.9161 18.2324 13.8125V12.25C18.2326 12.1463 18.2739 12.047 18.3473 11.9737C18.4206 11.9005 18.52 11.8593 18.6237 11.8592H21.4724C21.6879 11.8592 21.8458 12.0337 21.8229 12.2475L21.6537 13.815V13.815ZM24.667 21.2346V21.2317L24.6637 21.2346H22.8237C22.8116 21.2346 22.8012 21.2287 22.7891 21.2271C22.787 21.2129 22.787 21.1988 22.7845 21.1838L22.7662 21.2221C22.7713 21.2234 22.7764 21.2245 22.7816 21.2254C22.5895 21.2033 22.452 21.0446 22.4741 20.8462L22.5999 19.6696C22.6139 19.5638 22.6653 19.4665 22.7448 19.3953C22.8243 19.3241 22.9266 19.2836 23.0333 19.2812H25.1483C25.3637 19.2812 25.512 19.4546 25.4795 19.6675L25.295 20.8483C25.2629 21.0608 25.0595 21.2346 24.8441 21.2346H24.667" fill="silver" />
    </svg>






